# Installation Security

## Interactive Installation

Saat menjalankan installer, sistem akan:

1. **Prompt konfigurasi** - Input domain, IP, ports
2. **Generate client.config.sh** - Auto-generated dari input
3. **Generate secrets** - JWT, API Key, CSRF secrets
4. **Generate .env files** - Backend & frontend
5. **Setup database** - Auto-generate strong password
6. **Send Telegram notification** - Credentials dikirim otomatis

## Installation Process

### Ubuntu/Standard Server:
```bash
git clone https://github.com/rafall04/cctv.git
cd cctv
sudo bash deployment/install.sh
```

### aaPanel Server:
```bash
git clone https://github.com/rafall04/cctv.git
cd cctv
sudo bash deployment/aapanel-install.sh
```

### Interactive Prompts:
```
Client Name [RAF NET]: â–ˆ
Frontend Domain (e.g., cctv.client.com): 
Backend Domain (e.g., api-cctv.client.com): 
Server IP [auto-detect]: 
Public Port [800]: 
Backend Port [3000]: 
MediaMTX HLS Port [8888]: 
MediaMTX WebRTC Port [8889]: 
MediaMTX API Port [9997]: 
Installation Directory [/var/www/cctv]: 
```

## Security Features

- **Auto-generated passwords** - 20 karakter random (A-Z, a-z, 0-9, special chars)
- **Auto-generated secrets** - JWT, API Key, CSRF menggunakan crypto.randomBytes
- **Installation UUID** - Unique identifier per instalasi
- **Telegram notification** - Credentials dikirim real-time
- **No hardcoded credentials** - Semua generated saat instalasi

## Generated Files

### `deployment/client.config.sh` (Auto-generated)
```bash
# Generated dari input user
CLIENT_NAME="Client Name"
FRONTEND_DOMAIN="cctv.client.com"
BACKEND_DOMAIN="api-cctv.client.com"
SERVER_IP="192.168.1.100"
# ... dll
```

**Note:** File ini di-gitignore, tidak di-commit ke repository

### `backend/.env` (Auto-generated)
```env
PORT=3000
JWT_SECRET=<auto-generated>
API_KEY_SECRET=<auto-generated>
CSRF_SECRET=<auto-generated>
ALLOWED_ORIGINS=<auto-generated>
# ... dll
```

### `frontend/.env` (Auto-generated)
```env
VITE_API_URL=http://api-cctv.client.com:800
VITE_API_KEY=CHANGE_THIS_AFTER_INSTALLATION
```

## Post-Installation

1. **Check Telegram** - Admin credentials dikirim otomatis
2. **Login admin panel** - Username: admin, Password: [dari Telegram]
3. **Generate API Key** - Settings > API Keys > Generate
4. **Update frontend/.env** - Ganti VITE_API_KEY dengan generated key
5. **Rebuild frontend** - `cd frontend && npm run build`
6. **Change admin password** - Untuk keamanan

## Update/Deploy

Setelah instalasi, gunakan script yang sudah load config otomatis:

```bash
# Update dari Git
bash deployment/update.sh

# Deploy perubahan
bash deployment/deploy.sh

# Start services
bash deployment/start.sh
```

Semua script otomatis load `client.config.sh` yang sudah di-generate saat instalasi.

## Notes

- Credentials hanya dikirim saat **first setup** (user admin belum ada)
- Jika setup ulang, admin user sudah ada = tidak generate password baru
- Installation metadata tersimpan di `system_settings` table
- `client.config.sh` tidak di-commit ke Git (per-installation config)
